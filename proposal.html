<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposal</title>
    <link rel="stylesheet" href="accessibility.css">
    <link rel="stylesheet" href="proposal.css">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">О нас</a></li>
                <li><a href="proposal.html">Упрощение текста</a></li>
                <li><a href="#" onclick="toggleAccessibility()"><img src="eye-icon.png" style="height: 20px;"></a></li>
                <li><a href="#" id="soundButton"><img src="sound_icon.png" style="height: 20px;"></a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="hero">
            <div class="hero-image-container">
                <img src="white_background.png" alt="White Background" class="hero-image blurred">
                <div class="hero-text" data-default-top="50%" data-default-left="50%" data-default-transform="translate(-50%, -50%)">
                    <h1 data-default-font-size="48px">Текст для Всех</h1>
                    <p data-default-font-size="24px">Выберите способ вставления финансового текста:</p>
                    <div class="button-container">
                        <div id="text-button" class="proposal-card" data-default-text="Вставьте текст" data-default-width="200px" data-default-height="100px" data-default-background-color="#007bff" data-default-color="white">Вставьте текст</div>
                        <div id="image-button" class="proposal-card" data-default-text="Вставьте документ" data-default-width="200px" data-default-height="100px" data-default-background-color="#007bff" data-default-color="white">Вставьте документ</div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <form id="submission-form" class="submission-form" data-default-top="65%" data-default-left="50%" data-default-transform="translate(-50%, -50%)" style="display: none;">
        <textarea id="input-area" rows="10" cols="50" data-default-value="" data-default-placeholder="Введите текст:"></textarea>
        <button type="button" onclick="submitText()">Отправить</button>
    </form>
    <form id="document-form" class="submission-form" data-default-top="65%" data-default-left="50%" data-default-transform="translate(-50%, -50%)" style="display: none;" enctype="multipart/form-data">
        <input type="file" id="file-input" accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
        <button type="button" onclick="submitDocument()">Отправить</button>
    </form>
    <div id="accessibilityBar" class="accessibility-bar" style="display: none;">
        <div class="accessibility-options">
            <span>Размер шрифта:</span>
            <button onclick="changeFontSize('small')"><img src="small.jpg" alt="small"></button>
            <button onclick="changeFontSize('medium')"><img src="medium.jpg" alt="medium"></button>
            <button onclick="changeFontSize('large')"><img src="large.jpg" alt="large"></button>
            <span>Цвета сайта:</span>
            <button id="color-black" onclick="changeColorScheme('black')"><img src="bl_wh.jpg" alt="black"></button>
            <button id="color-white" onclick="changeColorScheme('white')"><img src="wh_bl.jpg" alt="white"></button>
            <button id="color-blue" onclick="changeColorScheme('blue')"><img src="bl_sin.jpg" alt="blue"></button>
            <button id="color-beige" onclick="changeColorScheme('beige')"><img src="brwn.jpg" alt="beige"></button>
            <button id="color-yellow" onclick="changeColorScheme('yellow')"><img src="bl_green.jpg" alt="yellow"></button>
            <span>Изображения:</span>
            <button id="images-on" onclick="toggleImages(true)">Вкл</button>
            <button id="images-off" onclick="toggleImages(false)">Выкл</button>
        </div>
        <button onclick="resetAccessibility()">Вернуть стандартные настройки</button>
        <button onclick="toggleAccessibility()">Закрыть панель</button>
    </div>
    <div id="soundControlBar" class="accessibility-bar" style="display: none;">
        <div class="sound-options">
            <button id="playButton" onclick="playAudio()">
                <img src="play.png" alt="Play" style="height: 30px;">
            </button>
            <button id="stopButton" onclick="stopAudio()" style="display: none;">
                <img src="stop.png" alt="Stop" style="height: 30px;">
            </button>
            <button id="restartButton" onclick="restartAudio()">
                <img src="restart.png" alt="Restart" style="height: 30px;">
            </button>
            <button onclick="toggleSoundControl()">
                Закрыть панель
            </button>
        </div>
    </div>
    <script src="accessibility.js"></script>
    <script>
        document.getElementById('text-button').addEventListener('click', function() {
            const form = document.getElementById('submission-form');
            const inputArea = document.getElementById('input-area');
            inputArea.value = '';
            inputArea.placeholder = 'Введите текст:';
            form.style.display = 'block';
            document.getElementById('document-form').style.display = 'none';
        });

        document.getElementById('image-button').addEventListener('click', function() {
            const fileInput = document.getElementById('file-input');
            fileInput.click();
            fileInput.onchange = () => {
                if (fileInput.files && fileInput.files[0]) {
                    const form = document.getElementById('document-form');
                    form.style.display = 'block';
                    document.getElementById('submission-form').style.display = 'none';
                }
            };
        });

        function submitText() {
            const inputText = document.getElementById('input-area').value;
            localStorage.setItem('submittedText', inputText);
            window.location.href = 'output_text.html';
        }

        function submitDocument() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                localStorage.setItem('submittedDocument', event.target.result);
                window.location.href = 'output_text.html';
            };
            reader.readAsDataURL(file);
        }

        document.getElementById('soundButton').addEventListener('click', function () {
            toggleSoundControl(); // Show the sound control bar
        });

        function toggleSoundControl() {
            const soundControlBar = document.getElementById('soundControlBar');
            if (soundControlBar.style.display === "none") {
                soundControlBar.style.display = "flex";
            } else {
                soundControlBar.style.display = "none";
            }
        }

        function resetAccessibility() {
            document.body.style.fontSize = '';
            document.body.style.fontFamily = 'Arial, sans-serif';
            document.body.classList.remove('black-scheme', 'white-scheme', 'blue-scheme', 'beige-scheme', 'yellow-scheme');

            document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, .about-section p, .about-section h2, .hero-text h1, .hero-text p').forEach(element => {
                element.classList.remove('black-text', 'white-text', 'dark-blue-text', 'brown-text', 'green-text');
                element.style.fontSize = '';
                element.style.fontFamily = '';
                element.style.color = '';
                element.style.backgroundColor = '';
            });

            document.querySelectorAll('[data-default-font-size]').forEach(element => {
                element.removeAttribute('data-default-font-size');
            });

            document.querySelectorAll('header nav ul li a').forEach(element => {
                element.style.fontSize = '';
            });

            const proposalCards = document.querySelectorAll('.proposal-card');
            proposalCards.forEach(card => {
                card.style.width = card.getAttribute('data-default-width');
                card.style.height = card.getAttribute('data-default-height');
                card.style.backgroundColor = card.getAttribute('data-default-background-color');
                card.style.color = card.getAttribute('data-default-color');
            });

            const images = document.querySelectorAll('.about-section .content img.about-image');
            images.forEach(image => {
                image.style.width = '';
                image.style.maxWidth = '';
                image.style.height = '';
            });

            currentFontSize = 'medium';
            toggleImages(true);
            imagesHidden = false;

            const icons = document.querySelectorAll('header nav ul li a img');
            icons.forEach(icon => {
                icon.style.height = '';
                icon.removeAttribute('data-default-icon-size');
                icon.style.verticalAlign = 'middle';
            });

            clearInterval(slideInterval);
            currentSlide = 0;
            showSlide(currentSlide);
            slideInterval = setInterval(nextSlide, slideIntervalTime);

            updateActiveButton('');

            // Reset the form and buttons
            const form = document.getElementById('submission-form');
            form.style.top = form.getAttribute('data-default-top');
            form.style.left = form.getAttribute('data-default-left');
            form.style.transform = form.getAttribute('data-default-transform');
            form.style.display = 'none';

            const inputArea = document.getElementById('input-area');
            inputArea.value = inputArea.getAttribute('data-default-value');
            inputArea.placeholder = inputArea.getAttribute('data-default-placeholder');

            const textButton = document.getElementById('text-button');
            const imageButton = document.getElementById('image-button');
            textButton.textContent = textButton.getAttribute('data-default-text');
            imageButton.textContent = imageButton.getAttribute('data-default-text');
        }

        // For sound control
        let audio;
        let audioUrl = '';
        let audioPaused = false;

        function playAudio() {
            if (!audioUrl) {
                let textContent = '';
                const elements = document.querySelectorAll('main, .about-text p');
                elements.forEach(element => {
                    textContent += element.textContent + ' ';
                });

                textContent = textContent.trim();

                const data = JSON.stringify({ text: textContent });

                fetch('https://10a2-88-201-206-51.ngrok-free.app/text_to_speech', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: data
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.blob();
                })
                .then(blob => {
                    audioUrl = window.URL.createObjectURL(blob);
                    audio = new Audio(audioUrl);
                    audio.play();
                    document.getElementById('playButton').style.display = 'none';
                    document.getElementById('stopButton').style.display = 'inline';
                })
                .catch(error => console.error('Ошибка:', error));
            } else {
                if (audioPaused) {
                    audio.play();
                    audioPaused = false;
                } else {
                    audio = new Audio(audioUrl);
                    audio.play();
                }
                document.getElementById('playButton').style.display = 'none';
                document.getElementById('stopButton').style.display = 'inline';
            }
        }

        function stopAudio() {
            if (audio) {
                audio.pause();
                audioPaused = true;
                document.getElementById('playButton').style.display = 'inline';
                document.getElementById('stopButton').style.display = 'none';
            }
        }

        function restartAudio() {
            if (audio) {
                audio.currentTime = 0;
                audio.play();
                audioPaused = false;
                document.getElementById('playButton').style.display = 'none';
                document.getElementById('stopButton').style.display = 'inline';
            }
        }
    </script>
</body>
</html>
